#!/usr/bin/env php
<?php
//
//  Usage: ./bin/test [file_or_dir [file_or_dir [file_or_dir ...]]]
//  Examples:
//      ./bin/test ./tests
//      ./bin/test tests/testModel.php tests/fixtures/
//      ./bin/test tests/testModel.php tests/fixtures/tipy.sql
//
defined('TEST_MODE') || define('TEST_MODE', true);

// If no config defined try to search trough arguments
if (!defined('INI_FILE')) {
    foreach ($argv as $filename) {
        if (preg_match('/config\.ini$/', $filename) && file_exists($filename)) {
            define('INI_FILE', $filename);
        }
    }
}
// If still not defined try to use config file from tests directory
// If even this fails check if we are on CircleCI and use CircleCI's config file
if (!defined('INI_FILE')) {
    if (file_exists(getcwd().'/config.ini')) {
        define('INI_FILE', getcwd().'/config.ini');
    } else if (file_exists(__DIR__.'/../tests/config.ini')) {
        define('INI_FILE', __DIR__.'/../tests/config.ini');
    } else if (getenv("CIRCLECI")) {
        define('INI_FILE', __DIR__.'/../tests/config.ini.ci');
    } else {
        exit("Please specify config file or put config.ini to current directory".PHP_EOL);
    }
}

require_once(__DIR__.'/../src/TipyTestSuite.php');

$runner = new TestRunner();
$runner->run();
